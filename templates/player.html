{% extends 'index.html' %} {% block body_block %}

<div class="container">


    <div class="section">
        <div class="row">

            {% if errors %}
                        {% for i in errors %}
                                <h3>{{ i }}</h3>
                        {% endfor %}

                {% else %}

        </div>  
        <form method="get" action="/playerPage" id="myform"> 
            
            <div class="row">
                <h4 style="color:green"><center>My Player Data</center></h4>    
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <select name="myPlayerSelect" id="myPlayerSelect">
                        <option value="">Select Batsman</option>
                        {%for i in myPlayerList %}
                            {% if i.player_name.player_name == myPlayer.player_name.player_name %}
                                 <option value="{{i.player_name.player_name}}" selected>{{i.player_name.player_name}}</option>
                            {% else %}
                                <option value="{{i.player_name.player_name}}">{{i.player_name.player_name}}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col s6">
                    <input id="search" class="btn btn-medium green" type="submit" value="Go" />
                </div>
            </div>
                  
        {% if player_sentiment_dict %}
        <div class="row">
                <h4 style="color:#2196f3"><center>Player's Sentiment Analysis Timeline</center></h4>    
            </div>
        <div class="row">
                <div id="player_sentiment_chart" style="width: 900px; height: 500px;"></div>
        </div>
        {% endif %}


        {% if articles %}
        <div class="divider"></div>
        <div class="row">
            <h4 style="color:green"><center>News Articles</center></h4>    
        </div>

            <div class="row">
                {% for single_article in articles %}
                <div class="col s12">
                  <div class="card green lighten-4">
                    <div class="card-content black-text">
                      <span class="card-title"><center><b>{{single_article.title}}</b></center></span>
                            <table>
                                <tbody>
                                  <tr>
                                    <td>Date</td>
                                    <td>{{single_article.date}}</td>
                                  </tr>
                                  <tr>
                                    <td>Summary</td>
                                    <td>{{single_article.summary}}</td>
                                  </tr>
                                </tbody>
                            </table>
                            <div class="card-action white-text">
                                 <a href="{{single_article.article_url}}" target="_blank" style="color:black" >Click here to read full article...</a>
                            </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
            </div>

            <div class="row"> 
                <div class="pagination">
                <span class="step-links">
                  {% if articles.has_previous %}
                  <a id="prev_article_link" href="?article_page={{ articles.previous_page_number }}&myPlayerSelect=MS+Dhoni"+>previous</a>
                  {% endif %}

                <span class="current">
                  Page {{ articles.number }} of {{ articles.paginator.num_pages }}.
                </span>

                  {% if articles.has_next %}
                  <a id="next_article_link" href="?article_page={{ articles.next_page_number }}&myPlayerSelect=MS+Dhoni">next</a>
                  {% endif %}
                </span>
                </div>
            </div>

        {% endif %}


        {% if newsTweets %}

        <div class="divider"></div>
        <div class="row">
            <h4 style="color:#2196f3"><center>News Tweets</center></h4>    
        </div>
        <div class="row">
                {% for single_news_tweet in newsTweets %}
                <div class="col s12">
                  <div class="card light-blue lighten-3">
                    <div class="card-content white-text">
                      <span class="card-title"><center><b>{{single_news_tweet.username}}</b></center></span>
                        <div class="card-content">
                            <p><b>{{single_news_tweet.date}}</b></p>
                            <p><b>{{single_news_tweet.text}}</b></p>
                        </div>
                        <div class="card-action"> 
                                 <a href="{{single_news_tweet.permalink}}" target="_blank" style="color:white"><b>Click here to read on Twitter...</b></a>
                        </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
            </div>

            <div class="row"> 
                <div class="pagination">
                <span class="step-links">
                  {% if newsTweets.has_previous %}
                  <a id="prev_news_tweet_link" href="?news_tweet_page={{ newsTweets.previous_page_number }}&myPlayerSelect=Virat+Kohli"+>previous</a>
                  {% endif %}

                <span class="current">
                  Page {{ newsTweets.number }} of {{ newsTweets.paginator.num_pages }}.
                </span>

                  {% if newsTweets.has_next %}
                  <a id="next_news_tweet_link" href="?news_tweet_page={{ newsTweets.next_page_number }}&myPlayerSelect=Virat+Kohli">next</a>
                  {% endif %}
                </span>
                </div>
            </div>

        {% endif %}



    {% if match_data %}
        <div class="divider"></div>
        <div class="row">
            <h4 style="color:green"><center>Recent Match Stats</center></h4>    
        </div>

                <div class="row">
                
                <div class="col s12">                
                            <table class = "bordered highlight">
                                <thead>
                                    <th>Date</th>
                                    <th>Runs</th>
                                    <th>Fours</th>
                                    <th>Sixes</th>
                                    <th>Strike Rate</th>
                                    <th>Opponent Team</th>
                                    <th>Match Result</th>
                                </thead>
                                <tbody>
                                {% for match_record in match_data %}
                                      <tr>
                                        <td>{{match_record.match_date}}</td>
                                        <td>{{match_record.runs}}</td>
                                        <td>{{match_record.fours}}</td>
                                        <td>{{match_record.six}}</td>
                                        <td>{{match_record.strike_rate}}</td>
                                        <td>{{match_record.opponent_team_name}}</td>
                                        <td>{{match_record.match_status}}</td>
                                      </tr>
                                  {% endfor %}
                                </tbody>
                            </table>
                    </div>
            </div>
            
        {% endif %}


        {% if playerTweets %}

        <div class="row">
            <h4 style="color:#2196f3"><center>User Tweets</center></h4>    
        </div>
        <div class="row">
                {% for single_tweet in playerTweets %}
                <div class="col s12">
                  <div class="card light-blue lighten-3">
                    <div class="card-content white-text">
                      <span class="card-title"><center><b>{{single_tweet.username}}</b></center></span>
                        <div class="card-content">
                            <p><b>{{single_tweet.date}}</b></p>
                            <p><b>{{single_tweet.text}}</b></p>
                        </div>
                        <div class="card-action"> 
                                 <a href="{{single_tweet.permalink}}" target="_blank" style="color:white"><b>Read Tweet on Twitter...</b></a>
                        </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
            </div>

            <div class="row"> 
                <div class="pagination">
                <span class="step-links">
                  {% if playerTweets.has_previous %}
                  <a id="prev_user_tweet_link" href="?user_tweet_page={{ playerTweets.previous_page_number }}&myPlayerSelect=MS+Dhoni"+>previous</a>
                  {% endif %}

                <span class="current">
                  Page {{ playerTweets.number }} of {{ playerTweets.paginator.num_pages }}.
                </span>

                  {% if playerTweets.has_next %}
                  <a id="next_user_tweet_link" href="?user_tweet_page={{ playerTweets.next_page_number }}&myPlayerSelect=MS+Dhoni">next</a>
                  {% endif %}
                </span>
                </div>
            </div>

        {% endif %}
                {% endif %} <!-- This endif handles closes the else case condition - when no error-->
           </form>
    </div>
</div>
<script type="text/javascript">

  function goArticleNext() {
   
    var my_player_val = $('#myPlayerSelect').val();
     var href = $('#next_article_link').attr("href")
     var nhref = "";
     nhref = '/playerPage'+href+'&myPlayerSelect='+my_player_val;

    $('#next_article_link').attr("href",nhref);
    final = $('#next_article_link').attr("href");
    alert('final link to go : '+final)
  }

  function goArticlePrev() {
   
    var my_player_val = $('#myPlayerSelect').val();
     var href = $('#prev_article_link').attr("href");
     var nhref = "";
     nhref = '/playerPage'+href+'&myPlayerSelect='+my_player_val;

    $('#prev_article_link').attr("href",nhref);
    final = $('#prev_article_link').attr("href");
    alert('final link to go : '+final)
  }

  var playerSentimentChart = c3.generate({
      bindto: '#player_sentiment_chart',
      data: {
          
          x: 'x',
  //        xFormat: '%Y%m%d', // 'xFormat' can be used as custom format of 'x'
          columns: [
              ['x', '2016-03-18','2016-03-22','2016-03-26','2016-03-30','2016-04-03'],
              {% for key, value in player_sentiment_dict.items %}
                ['{{key}}', {{value}}],
              {% endfor %}
          ]
      },
      axis: {
          x: {
              type: 'timeseries',
              tick: {
                  format: '%Y-%m-%d'
              }
          }
      }
  });

setTimeout(function () {
    playerSentimentChart.transform('bar', 'Positive %');
}, 1000);

setTimeout(function () {
    playerSentimentChart.transform('bar', 'Negative %');
}, 2000);

setTimeout(function () {
    playerSentimentChart.transform('bar', 'Neutral %');
}, 3000);

setTimeout(function () {
    playerSentimentChart.transform('line');
}, 4000);

setTimeout(function () {
    playerSentimentChart.transform('bar');
}, 5000);


</script>

{% endblock %}
